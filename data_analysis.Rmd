---
title: "lab_11"
author: "sean mussenden"
date: "8/26/2021"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

#Libraries
```{r}
library(tidyverse)
library(janitor)
```

# Load and Clean Data

##Seperate out data for D.C. and save to new csv file
```{r}
for (year in 10:18){
  inputFilename <- str_c("data/state_csv/state_may_20", toString(year), ".csv")
  outputFilename <- str_c("data/DC/dc_may_20", toString(year), ".csv")
  
  all_states <- read.csv(inputFilename)
  all_states <- all_states %>% 
    filter(AREA == 11) %>%
    rename(AREA_NAME = STATE) %>% 
    write_csv(outputFilename)
}

#Column format changes in 2019
for (year in 19:21){
  inputFilename <- str_c("data/state_csv/state_may_20", toString(year), ".csv")
  outputFilename <- str_c("data/DC/dc_may_20", toString(year), ".csv")
  
  all_states <- read.csv(inputFilename)
  names(all_states) <- toupper(names(all_states))
  
  all_states <- all_states %>% 
    filter(AREA == 11) %>%
    rename(AREA_NAME = AREA_TITLE) %>% 
    write_csv(outputFilename)
}
```

##Seperate out San Francisco
```{r}
for (year in 10:18){
  inputFilename <- str_c("data/metro_areas_csv/metro_may_20", toString(year),".csv")
  outputFilename <- str_c("data/SF/sf_may_20", toString(year), ".csv")
  
  all_areas <- read.csv(inputFilename)
  
  all_areas %>% 
    filter(!is.na(str_match(AREA_NAME, "San Francisco"))) %>%
    write_csv(outputFilename)
}

#Column format changes in 2019
for (year in 19:21){
  inputFilename <- str_c("data/metro_areas_csv/metro_may_20", toString(year), ".csv")
  outputFilename <- str_c("data/SF/sf_may_20", toString(year), ".csv")
  
  all_areas <- read.csv(inputFilename)
  names(all_areas) <- toupper(names(all_areas))
  
  all_areas %>% 
    filter(!is.na(str_match(AREA_TITLE, "San Francisco"))) %>%
    rename(AREA_NAME = AREA_TITLE) %>% 
    write_csv(outputFilename)
}
```

##Seperate out Seattle
```{r}
for (year in 10:17){
  inputFilename <- str_c("data/metro_areas_csv/metro_may_20", toString(year),".csv")
  outputFilename <- str_c("data/SEA/sea_may_20", toString(year), ".csv")
  all_areas <- read.csv(inputFilename)
  
  all_areas %>% 
    filter(!is.na(str_match(AREA_NAME, "Seattle"))) %>%
    write_csv(outputFilename)
}

#Column format changes in 2019
for (year in 19:21){
  for(i in 1:3){
  inputFilename <- str_c("data/metro_areas_csv/metro_may_20", toString(year), ".csv")
  outputFilename <- str_c("data/SEA/sea_may_20", toString(year), ".csv")
  
  all_areas <- read.csv(inputFilename)
  names(all_areas) <- toupper(names(all_areas))
  
  all_areas %>% 
    filter(!is.na(str_match(AREA_TITLE, "Seattle"))) %>%
    rename(AREA_NAME = AREA_TITLE) %>% 
    write_csv(outputFilename)
  }
}
```

##Stitch every year of DC data together
```{r}
dc_all_years <- tibble()

for (year in 2011:2021){
  next_year <- read_csv(str_c("data/DC/dc_may_", year, ".csv"))
  next_year <- next_year %>% 
    mutate(YEAR = year)
  dc_all_years <- dc_all_years %>% bind_rows(next_year)
}

dc_all_years %>% 
  write_csv("data/DC/dc_all_years.csv")
```

##Stitch every year of Seattle data together
```{r}
sea_all_years <- tibble()

for (year in 2011:2021){
  next_year <- read_csv(str_c("data/SEA/sea_may_", year, ".csv"))
  next_year <- next_year %>% 
    mutate(YEAR = year)
  sea_all_years <- sea_all_years %>% bind_rows(next_year)
}

sea_all_years %>% 
  write_csv("data/SEA/sea_all_years.csv")

```

##Stitch every year of San Francisco data together
```{r}
sf_all_years <- tibble()

for (year in 2011:2021){
  print(year)
  next_year <- read_csv(str_c("data/SF/sf_may_", year, ".csv"))
  next_year <- next_year %>% 
    mutate(YEAR = year)
  sf_all_years <- sf_all_years %>% bind_rows(next_year)
}

sf_all_years %>% 
  write_csv("data/SF/sf_all_years.csv")

```


##Clean up column names and fix data types
```{r}
dc_all_years <- dc_all_years %>% 
  clean_names() %>% 
  mutate(tot_emp = as.numeric(tot_emp)) %>% 
  mutate(jobs_1000 = as.numeric(jobs_1000)) %>% 
  mutate(h_mean = as.numeric(h_mean)) %>% 
  mutate(a_mean = as.numeric(a_mean)) %>% 
  mutate(mean_prse = as.numeric(mean_prse)) %>% 
  mutate(h_pct10 = as.numeric(h_pct10)) %>% 
  mutate(h_pct25 = as.numeric(h_pct25)) %>% 
  mutate(h_pct10 = as.numeric(h_pct10)) %>% 
  mutate(h_median = as.numeric(h_median)) %>% 
  mutate(h_pct75 = as.numeric(h_pct75)) %>% 
  mutate(h_pct90 = as.numeric(h_pct90)) %>% 
  mutate(a_pct10 = as.numeric(a_pct10)) %>% 
  mutate(a_pct25 = as.numeric(a_pct25)) %>% 
  mutate(a_pct10 = as.numeric(a_pct10)) %>% 
  mutate(a_median = as.numeric(a_median)) %>% 
  mutate(a_pct75 = as.numeric(a_pct75)) %>% 
  mutate(a_pct90 = as.numeric(a_pct90))
```

```{r}
sea_all_years <- sea_all_years %>% 
  clean_names() %>% 
  mutate(tot_emp = as.numeric(tot_emp)) %>% 
  mutate(jobs_1000 = as.numeric(jobs_1000)) %>% 
  mutate(h_mean = as.numeric(h_mean)) %>% 
  mutate(a_mean = as.numeric(a_mean)) %>% 
  mutate(mean_prse = as.numeric(mean_prse)) %>% 
  mutate(h_pct10 = as.numeric(h_pct10)) %>% 
  mutate(h_pct25 = as.numeric(h_pct25)) %>% 
  mutate(h_pct10 = as.numeric(h_pct10)) %>% 
  mutate(h_median = as.numeric(h_median)) %>% 
  mutate(h_pct75 = as.numeric(h_pct75)) %>% 
  mutate(h_pct90 = as.numeric(h_pct90)) %>% 
  mutate(a_pct10 = as.numeric(a_pct10)) %>% 
  mutate(a_pct25 = as.numeric(a_pct25)) %>% 
  mutate(a_pct10 = as.numeric(a_pct10)) %>% 
  mutate(a_median = as.numeric(a_median)) %>% 
  mutate(a_pct75 = as.numeric(a_pct75)) %>% 
  mutate(a_pct90 = as.numeric(a_pct90))
```

```{r}
sf_all_years <- sf_all_years %>% 
  clean_names() %>% 
  mutate(tot_emp = as.numeric(tot_emp)) %>% 
  mutate(jobs_1000 = as.numeric(jobs_1000)) %>% 
  mutate(h_mean = as.numeric(h_mean)) %>% 
  mutate(a_mean = as.numeric(a_mean)) %>% 
  mutate(mean_prse = as.numeric(mean_prse)) %>% 
  mutate(h_pct10 = as.numeric(h_pct10)) %>% 
  mutate(h_pct25 = as.numeric(h_pct25)) %>% 
  mutate(h_pct10 = as.numeric(h_pct10)) %>% 
  mutate(h_median = as.numeric(h_median)) %>% 
  mutate(h_pct75 = as.numeric(h_pct75)) %>% 
  mutate(h_pct90 = as.numeric(h_pct90)) %>% 
  mutate(a_pct10 = as.numeric(a_pct10)) %>% 
  mutate(a_pct25 = as.numeric(a_pct25)) %>% 
  mutate(a_pct10 = as.numeric(a_pct10)) %>% 
  mutate(a_median = as.numeric(a_median)) %>% 
  mutate(a_pct75 = as.numeric(a_pct75)) %>% 
  mutate(a_pct90 = as.numeric(a_pct90))
```

##Create data frames for DC restaurant occupations and write to csv
```{r}
dc_bartenders <- dc_all_years %>% 
  filter(occ_title== "Bartenders") %>% 
  group_by(year) %>% 
  summarise(
    h_pct10,
    h_pct25,
    h_median,
    h_pct75,
    h_pct90,
    h_mean,
    tot_emp
  ) %>% 
  write_csv("data/dc_bartenders.csv")

dc_servers <- dc_all_years %>% 
  filter(occ_title== "Waiters and Waitresses") %>% 
  group_by(year) %>% 
  summarise(
    h_pct10,
    h_pct25,
    h_median,
    h_pct75,
    h_pct90,
    h_mean,
    tot_emp
  ) %>% 
  write_csv("data/dc_servers.csv")

	

dc_counter_service <- dc_all_years %>% 
  filter(occ_title== "Counter Attendants, Cafeteria, Food Concession, and Coffee Shop") %>% 
  group_by(year) %>% 
  summarise(
    h_pct10,
    h_pct25,
    h_median,
    h_pct75,
    h_pct90,
    h_mean,
    tot_emp
  ) %>% 
  write_csv("data/dc_counter_service.csv")

dc_dishwashers <- dc_all_years %>% 
  filter(occ_title== "Dishwashers") %>% 
  group_by(year) %>% 
  summarise(
    h_pct10,
    h_pct25,
    h_median,
    h_pct75,
    h_pct90,
    h_mean,
    tot_emp
  ) %>% 
  write_csv("data/dc_dishwashers.csv")


dc_cooks <- dc_all_years %>% 
  filter(occ_title== "Cooks, Restaurant") %>% 
  group_by(year) %>% 
  summarise(
    h_pct10,
    h_pct25,
    h_median,
    h_pct75,
    h_pct90,
    h_mean,
    tot_emp
  ) %>% 
  write_csv("data/dc_cooks.csv")

dc_head_chefs <- dc_all_years %>% 
  filter(occ_title== "Chefs and Head Cooks") %>% 
  group_by(year) %>% 
  summarise(
    h_pct10,
    h_pct25,
    h_median,
    h_pct75,
    h_pct90,
    h_mean,
    tot_emp
  ) %>% 
  write_csv("data/dc_head_chefs.csv")
```

##Data frames for Seattle restaurant occupations
```{r}
sea_bartenders <- sea_all_years %>% 
  filter(occ_title== "Bartenders") %>% 
  group_by(year) %>% 
  summarise(
    h_pct10,
    h_pct25,
    h_median,
    h_pct75,
    h_pct90,
    h_mean,
    tot_emp
  ) %>% 
  write_csv("data/sea_bartenders.csv")

sea_servers <- sea_all_years %>% 
  filter(occ_title== "Waiters and Waitresses") %>% 
  group_by(year) %>% 
  summarise(
    h_pct10,
    h_pct25,
    h_median,
    h_pct75,
    h_pct90,
    h_mean,
    tot_emp
  ) %>% 
  write_csv("data/sea_servers.csv")

sea_counter_service <- sea_all_years %>% 
  filter(occ_title== "Counter Attendants, Cafeteria, Food Concession, and Coffee Shop") %>% 
  group_by(year) %>% 
  summarise(
    h_pct10,
    h_pct25,
    h_median,
    h_pct75,
    h_pct90,
    h_mean,
    tot_emp
  ) %>% 
  write_csv("data/sea_counter_service.csv")

sea_dishwashers <- sea_all_years %>% 
  filter(occ_title== "Dishwashers") %>% 
  group_by(year) %>% 
  summarise(
    h_pct10,
    h_pct25,
    h_median,
    h_pct75,
    h_pct90,
    h_mean,
    tot_emp
  ) %>% 
  write_csv("data/sea_dishwashers.csv")

sea_cooks <- sea_all_years %>% 
  filter(occ_title== "Cooks, Restaurant") %>% 
  group_by(year) %>% 
  summarise(
    h_pct10,
    h_pct25,
    h_median,
    h_pct75,
    h_pct90,
    h_mean,
    tot_emp
  ) %>% 
  write_csv("data/sea_cooks.csv")

sea_head_chefs <- sea_all_years %>% 
  filter(occ_title == "Chefs and Head Cooks") %>% 
  group_by(year) %>% 
  summarise(
    h_pct10,
    h_pct25,
    h_median,
    h_pct75,
    h_pct90,
    h_mean,
    tot_emp
  ) %>% 
  write_csv("data/sea_head_chefs.csv")
```

##Data frames for San Francisco restaurant occupations
```{r}
sf_bartenders <- sf_all_years %>% 
  filter(occ_title== "Bartenders") %>% 
  group_by(year) %>% 
  summarise(
    h_pct10,
    h_pct25,
    h_median,
    h_pct75,
    h_pct90,
    h_mean,
    tot_emp
  ) %>% 
  write_csv("data/sf_bartenders.csv")

sf_servers <- sf_all_years %>% 
  filter(occ_title== "Waiters and Waitresses") %>% 
  group_by(year) %>% 
  summarise(
    h_pct10,
    h_pct25,
    h_median,
    h_pct75,
    h_pct90,
    h_mean,
    tot_emp
  ) %>% 
  write_csv("data/sf_servers.csv")

sf_counter_service <- sf_all_years %>% 
  filter(occ_title== "Counter Attendants, Cafeteria, Food Concession, and Coffee Shop") %>% 
  group_by(year) %>% 
  summarise(
    h_pct10,
    h_pct25,
    h_median,
    h_pct75,
    h_pct90,
    h_mean,
    tot_emp
  ) %>% 
  write_csv("data/sf_counter_service.csv")

sf_dishwashers <- sf_all_years %>% 
  filter(occ_title== "Dishwashers") %>% 
  group_by(year) %>% 
  summarise(
    h_pct10,
    h_pct25,
    h_median,
    h_pct75,
    h_pct90,
    h_mean,
    tot_emp
  ) %>% 
  write_csv("data/sf_dishwashers.csv")

sf_cooks <- sf_all_years %>% 
  filter(occ_title== "Cooks, Restaurant") %>% 
  group_by(year) %>% 
  summarise(
    h_pct10,
    h_pct25,
    h_median,
    h_pct75,
    h_pct90,
    h_mean,
    tot_emp
  ) %>% 
  write_csv("data/sf_cooks.csv")

sf_head_chefs <- sf_all_years %>% 
  filter(occ_title == "Chefs and Head Cooks") %>% 
  group_by(year) %>% 
  summarise(
    h_pct10,
    h_pct25,
    h_median,
    h_pct75,
    h_pct90,
    h_mean,
    tot_emp
  ) %>% 
  write_csv("data/sf_head_chefs.csv")
```


# Exploratory analysis
```{r}
glimpse(dc_all_years)
glimpse(sf_all_years)
```
```{r}
summary(dc_all_years)
summary(sf_all_years)
```

## Limitations or flaws
- When cleaning the data, it was possible that we might have introduced errors into the dataset, since we used different methods to clean and combine our data. Going forward, we should check our data cleaning techniques and make sure that all our work matches up as we continue to clean and add more data.
- While cleaning our data, we noticed that in 2018, they added new information to the data that was previously not included (like another group definition, NAICS code and own code).
- With a little bit more exploration, I think we should be able to use this data to answer our questions once we understand the columns and what data they provide a little more. 
- This data currently holds a lot of data on occupants, but not more detailed information on areas we are specifically looking into (careers where tip credit matters), so going forward, we may want to incorporate other data to compare with what we've already collected and combined


#Question 1: Do workers in cities without the tip credit make more money than workers in cities that pay the sub-minimum wage?
Stacked bar graph 
DC has tip credit, Seattle and SF don’t

```{r}




```





#Question 2: How are workers across the earning spectrum affected by the tip credit (if at all)

To answer this question I generated line graphs (viewable via "webpage/index.html") for servers and bartenders in each city to get a sense of the gaps between income levels and how wages have changed over time. 

I also collected minimum wage data from the web for each city (https://www.laborlawcenter.com/state-minimum-wage-rates, https://sfgov.org/olse/historical-wage-rates-definition-government-supported-employee, https://library.municode.com/wa/seattle/codes/municipal_code?nodeId=TIT14HURI_CH14.19MIWAMICORAEMPEWOSE_14.19.030HOMIWACH1EM, 
https://www.seattle.gov/documents/Departments/LaborStandards/OLS-MW-multiyearChart2022%20%28002%29.pdf)

Because BLS collects and groups data for San Francisco/Seattle as well as their surrounding metropolitan areas, minimum wages are presented as a range between the state minimum as a low and the city minimum as a high.

Looking at the chart, in each city workers in the bottom 25th and 10th percentiles have very little difference in their wages and make roughly the minimum wage. This data shows that being paid the full minimum wage without a tip credit does not have a significant impact on earnings of workers at the bottom of the income scale. One noticeable difference between DC and the two cities without tip credits is there is a much larger gap between the top earners and the median income, with one exception being San Francisco bartenders. In 2018 this gap was almost $34 for servers in DC, while the range of incomes in cities with no tip credit seems to be much tighter.


#Question 3: How do tip credits affect the wage gap between front and back-of-house workers?
##- FOH (Bartenders, servers) v. BOH( cooks/dishwashers	)
##- Gap in earnings (find the difference between FOH average and BOH average median)
##- Possibly report it in a table with the median for each of these groups as well -- DataWrapper table with filtering


## comparing bartenders and servers (FOH) with BOH (cooks and dishwashers)
```{r}
sea_all_years<- read_csv("https://raw.githubusercontent.com/justinrobinson1020/data_analysis_project/main/data/SEA/sea_all_years.csv")
```
1. Create a combined table with year, median, and total employees for FOH workers in each city (bartenders and servers)

###Seattle:
```{r}
sea_servers_to_combine <- sea_servers %>%
  select(year, h_median, tot_emp) %>%
  rename(server_median = h_median) %>%
  rename(server_emp = tot_emp)
sea_bartenders_to_combine <- sea_bartenders %>%
  select(year, h_median, tot_emp) %>%
  rename(bartenders_median = h_median) %>%
  rename(bartenders_emp = tot_emp)
```

```{r}
sea_FOH <- sea_servers_to_combine %>%
  left_join(sea_bartenders_to_combine)
sea_FOH <- sea_FOH %>%
  mutate(average_FOH_wage = (server_median + bartenders_median)/2)
```


###SanFran
```{r}
sf_servers_to_combine <- sf_servers %>%
  select(year, h_median, tot_emp) %>%
  rename(server_median = h_median) %>%
  rename(server_emp = tot_emp)
sf_bartenders_to_combine <- sf_bartenders %>%
  select(year, h_median, tot_emp) %>%
  rename(bartenders_median = h_median) %>%
  rename(bartenders_emp = tot_emp)
```

```{r}
sf_FOH <- sf_servers_to_combine %>%
  left_join(sf_bartenders_to_combine)
sf_FOH <- sf_FOH %>%
  mutate(average_FOH_wage = (server_median + bartenders_median)/2)
```



###DC
```{r}
dc_servers_to_combine <-dc_servers %>%
  select(year, h_median, tot_emp) %>%
  rename(server_median = h_median) %>%
  rename(server_emp = tot_emp)
dc_bartenders_to_combine <- dc_bartenders %>%
  select(year, h_median, tot_emp) %>%
  rename(bartenders_median = h_median) %>%
  rename(bartenders_emp = tot_emp)
```

```{r}
dc_FOH <- dc_servers_to_combine %>%
  left_join(dc_bartenders_to_combine)
dc_FOH <- dc_FOH %>%
  mutate(average_FOH_wage = (server_median + bartenders_median)/2)
```

## 2. Create a combined table with year, median, and total employees for BOH workers in each city (cooks and dishwashers)

###Seattle
```{r}
sea_cooks_to_combine <- sea_cooks %>%
  select(year, h_median, tot_emp) %>%
  rename(cooks_median = h_median) %>%
  rename(cooks_emp = tot_emp)
sea_dishwashers_to_combine <- sea_dishwashers %>%
  select(year, h_median, tot_emp) %>%
  rename(dishwashers_median = h_median) %>%
  rename(dishwashers_emp = tot_emp)
```

```{r}
sea_BOH <- sea_cooks_to_combine %>%
  left_join(sea_dishwashers_to_combine)
sea_BOH <- sea_BOH %>%
  mutate(average_BOH_wage = (cooks_median + dishwashers_median)/2)
```

###SanFran
```{r}
sf_cooks_to_combine <- sf_cooks %>%
  select(year, h_median, tot_emp) %>%
  rename(cooks_median = h_median) %>%
  rename(cooks_emp = tot_emp)
sf_dishwashers_to_combine <- sf_dishwashers %>%
  select(year, h_median, tot_emp) %>%
  rename(dishwashers_median = h_median) %>%
  rename(dishwashers_emp = tot_emp)
```

```{r}
sf_BOH <- sf_cooks_to_combine %>%
  left_join(sf_dishwashers_to_combine)
sf_BOH <-sf_BOH %>%
  mutate(average_BOH_wage = (cooks_median + dishwashers_median)/2)
```



###DC 
```{r}
dc_cooks_to_combine <- dc_cooks %>%
  select(year, h_median, tot_emp) %>%
  rename(cooks_median = h_median) %>%
  rename(cooks_emp = tot_emp)
dc_dishwashers_to_combine <- dc_dishwashers %>%
  select(year, h_median, tot_emp) %>%
  rename(dishwashers_median = h_median) %>%
  rename(dishwashers_emp = tot_emp)
```

```{r}
dc_BOH <- dc_cooks_to_combine %>%
  left_join(dc_dishwashers_to_combine)
dc_BOH <- dc_BOH %>%
  mutate(average_BOH_wage = (cooks_median + dishwashers_median)/2)
```


## 3. Combine the FOH and BOH averages together and subtract them to find the difference for each city
```{r}
sea_FOH_BOH <- sea_FOH %>%
  left_join(sea_BOH)
sea_final <-sea_FOH_BOH %>%
  mutate(difference = average_FOH_wage - average_BOH_wage)
```
```{r}
SEA_difference_FOH_BOH <-mean(sea_final$difference)
```


```{r}
sf_FOH_BOH <- sf_FOH %>%
  left_join(sf_BOH)
sf_final <- sf_FOH_BOH %>%
  mutate(difference = average_FOH_wage - average_BOH_wage)
```

```{r}
SF_difference_FOH_BOH <-mean(sf_final$difference)
```

```{r}
dc_FOH_BOH <- dc_FOH %>%
  left_join(dc_BOH)
dc_final <- dc_FOH_BOH %>%
  mutate(difference = average_FOH_wage - average_BOH_wage)
```

```{r}
DC_difference_FOH_BOH <-mean(dc_final$difference)
```

To answer the question (3): How do tip credits affect the wage gap between front and back-of-house workers?

In all 3 cities, SF and Seattle with no tip credit, and DC with a tip credit, in 2021, BOH workers were making slightly more than FOH workers. When averaging this difference across all years, DC FOH and BOH workers make close to the same amount, with only a 7 cent difference. However, in San Francisco, FOH workers make 0.29 cents less and in Seattle, FOH workers make 0.57 cents more. Therefore, this data shows that having a tip credit might even the playing ground between FOH and BOH workers.

